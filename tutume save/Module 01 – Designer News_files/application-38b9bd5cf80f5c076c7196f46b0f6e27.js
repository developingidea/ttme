Stage.registerModule("cart",{el:$(".cart-index"),initialize:function(){this.purchaseForm=this.$("#new_purchase"),this.isFreePurchase=this.$(".free-purchase").length,this.postalCodeField=this.$("#purchase_postal_code"),this.creditCardFields=this.$("#credit-card-container"),this.stripeErrorMessage=this.$("#complete-purchase-stripe-error"),this.submitButton=this.$("#complete-purchase-submit-button"),this.stripeTokenField=this.$("#stripe-token"),this.taxAmountField=this.$("#purchase_tax_amount"),this.chargeAmountField=this.$("#purchase_total"),this.cartSections=this.$(".sidebar-cart-layout [data-section]"),this.cartValues=this.$(".sidebar-cart-layout [data-value]"),this.canSubmit=this.isFreePurchase||this.creditCardFields.hasClass("existing-card"),this.isFreePurchase||(Stripe.setPublishableKey(payment.stripe_key),this.updateTotal()),this.postalCodeField.on("input",this.updatePostalCode.bind(this)),this.$("#remove-credit-card").on("click",this.removeCreditCard.bind(this)),this.purchaseForm.on("submit",this.completePurchase.bind(this))},updatePostalCode:function(){var t=this.postalCodeField.val(),e=this._.helpers.checkPostalCode(t),i=this.cartSections.filter('[data-section="tax"]'),s=this.getTotal(!0);e?(this.taxAmount=s*.01*e.amount,this.taxAmountField.val(this._.helpers.centsToMoney(this.taxAmount)),this.cartValues.filter('[data-value="subtotal"]').text(this._.helpers.centsToMoney(s,!0)),this.cartValues.filter('[data-value="tax-type"]').text(e.amount+"% "+e.type),this.cartValues.filter('[data-value="tax-amount"]').text(this._.helpers.centsToMoney(this.taxAmount,!0)),this.updateTotal(),i.removeClass("hidden")):(i.addClass("hidden"),this.taxAmount=0,this.taxAmountField.val(""),this.updateTotal())},getTotal:function(t){var e=100*payment.base_price,i=this.taxAmount||0;return e+(t?0:i)},updateTotal:function(){var t=this.getTotal(),e=this.cartValues.filter('[data-value="total"]');e.text(this._.helpers.centsToMoney(t,!0)),this.chargeAmountField.val(t)},removeCreditCard:function(){var t=$.get("/me/forget_payment_information");t.done(function(){location.reload()})},completePurchase:function(t){if(t.preventDefault(),this.stripeErrorMessage.removeClass("visible"),this.submitButton.addClass("spinner-active"),this.canSubmit){var e=$.post(this.purchaseForm.attr("action"),this.purchaseForm.serialize());return e.done(function(){this.purchaseSuccess(),this._.modules["header.cart"].removeCart()}.bind(this)),e.fail(function(t){var e=t.responseJSON;e.purchases?(this.stripeErrorMessage.text(e.purchases.join(", ")).addClass("visible"),this.canSubmit=!1):this._.modules.site.errorModal(t.status,t.statusText),this.submitButton.removeClass("spinner-active")}.bind(this)),e.always(function(){this.submitButton.removeClass("spinner-active")}.bind(this)),void 0}this.creditCardFields.processStripe({success:function(t){this.stripeTokenField.val(t),this.canSubmit=!0,this.purchaseForm.submit()}.bind(this),error:function(t){this.stripeErrorMessage.text(t).addClass("visible"),this.submitButton.removeClass("spinner-active")}.bind(this)})},purchaseSuccess:function(){event.preventDefault();var t='<div class="modal-padding rte" id="purchase-success-model">';this.isFreePurchase||(t+='<p><b>Thank you.</b> Your purchase helps support independent designers in the Designer News community. If you have any questions or comments, please don\'t hesitate to <a href="hello@designernews.co">reach out</a>.</p>'),t+="<p>You can manage this and all previous market transactions on your purchases page.</p>",t+='<button id="close-modal" class="standard-button outline">Go to my purchases.</button>',t+="</div>";var e=new Stage.modal({title:this.isFreePurchase?"Download ready!":"Purchase success!",content:t,onExit:function(){return window.location="/me/purchases"}});event.preventDefault(),e.render(),e.content.on("click","#close-modal",function(){return window.location="/me/purchases"})}}),Stage.registerModule("comments",{el:$(".story-comment"),initialize:function(){this.el.each(this.setupComment.bind(this))},setupComment:function(t,e){e=$(e),commentInner=e.find("> .story-comment-inner"),commentInner.on("click",".story-comment-header",this.toggleCommentVisibility.bind(this)),commentInner.on("click",".story-comment-reply",this.toggleReply.bind(this)),commentInner.on("click",".story-comment-delete",this.deleteComment.bind(this)),commentInner.on("click",".story-comment-report",this.reportComment.bind(this)),commentInner.on("click",'[class*="vote-arrow"]',this.submitVote.bind(this))},toggleReply:function(t){var e=$(t.target).parent().parent().siblings(".new_comment");t.preventDefault(),e.toggleClass("visible"),e.hasClass("visible")&&e.find("textarea").focus()},deleteComment:function(t){var e=$(t.target).closest(".story-comment").attr("data-comment-id"),i='<div class="modal-padding rte" id="delete-content-model">';i+="<p>Are you sure you want to delete this comment? It cannot be undone. Deleting your comment will also remove all replies to it.</p>",i+='<button id="confirm-delete-comment" class="standard-button outline">Yes, delete this comment.</button>',i+="</div>";var s=new Stage.modal({title:"Delete this comment.",content:i}),a=function(){var t=$.ajax({url:"/comments/"+e,type:"DELETE"});t.done(function(){return window.location.reload()}),t.fail(function(t){s.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))};t.preventDefault(),s.render(),s.content.on("click","#confirm-delete-comment",a.bind(this))},reportComment:function(t){var e=$(t.target).closest(".story-comment").attr("data-comment-id"),i='<div class="modal-padding rte" id="report-content-model">';i+="<p>Are you sure you want to report this comment to moderators?</p>",i+='<div class="select-wrapper"><select><option selected>This looks like spam</option><option>This is offensive</option><option>I don\'t think this should be on DN</option></select><span class="select-label">This looks like spam</span></div>',i+='<button id="confirm-comment-report" class="standard-button outline">Yes, report this comment.</button>',i+="</div>";var s=new Stage.modal({title:"Report this comment.",content:i}),a=function(){var t=$.ajax({url:"/comments/"+e+"/report"+"?message="+s.$("select").find(":selected").text(),type:"POST"});t.done(function(){s.$("#report-content-model").html("<p>Thank you! Someone will take a look at this and take the appropriate action.</p>")}),t.fail(function(t){s.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))};t.preventDefault(),s.render(),s.content.on("click","#confirm-comment-report",a.bind(this))},submitVote:function(t){var e=$(t.target),i=e.closest(".story-comment").attr("data-comment-id"),s=e.attr("data-direction"),a=e.parent().siblings(".story-comment-points"),o=parseInt(a.text()),n="up"===s?o+1:o-1;a.text(n+(1===n||-1===n?" point":" points")),e.closest(".story-comment").attr("data-rating",n),e.remove();var r=$.post("/comments/votes/"+s+"vote.json","comment[id]="+i);r.fail(function(t){this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))},toggleCommentVisibility:function(t){var e=$(t.target),i=e.closest(".story-comment"),s=!e.is("a, button, svg, path");s&&i.toggleClass("collapsed")}}),Stage.registerModule("digest-signup",{el:$("#feed-digest-signup"),initialize:function(){this.emailField=$("#subscription_email"),this.$(".toggle-subscribe-popover").on("click",this.toggleSubscriptionPopover.bind(this))},toggleSubscriptionPopover:function(t){t&&t.preventDefault(),this.el.toggleClass("signup-form-visible"),setTimeout(function(){this.el.hasClass("signup-form-visible")&&this.emailField.focus()}.bind(this),200)}}),Stage.registerModule("flash",{el:$("#header-message-container"),initialize:function(){this.header=$("#header-container"),this.header.addClass("with-message"),this.$("#close-header-message-button").on("click",this.dismissFlash.bind(this))},dismissFlash:function(){this.header.removeClass("with-message"),this.el.remove()}}),Stage.registerModule("gallery",{el:$("#gallery-portraits-container"),initialize:function(){this.$("img").unveil(200,function(){var t=$(this);t.on("load",function(){t.parent().addClass("loaded")})})}}),Stage.registerModule("header.account",{el:$("#header-account-container"),initialize:function(){this.form=this.$("#header-login-form"),this.loginButton=this.form.find("#login-submit-button"),this.emailInput=this.form.children("#user_session_login"),this.passwordInput=this.form.children("#user_session_password"),this.body=$(document.body),this.processingLogin=!1,this.$("#header-login-form").on("submit",this.processLogin.bind(this))},toggleLogin:function(t){t&&t.preventDefault();var e=function(){$("html, body").animate({scrollTop:0},500),$("#header-container").hasClass("with-message")&&this._.modules.flash.dismissFlash.call(this._.modules.flash),this.body.addClass("header-account-container-active").one("transitionend webkitTransitionEnd",function(){this.emailInput.focus()}.bind(this))}.bind(this);if(this.body.hasClass("header-account-container-active")){if(0!==this.body.scrollTop())return e();this.body.removeClass("header-account-container-active")}else this.body.removeClass("header-search-active"),e()},processLogin:function(t){if(t.preventDefault(),!this.processingLogin){this.processingLogin=!0,this.loginButton.addClass("spinner-active");var e=$.post(this.form.attr("action"),this.form.serialize());e.done(function(){window.location.href=window.location.href}),e.fail(function(t){var e=JSON.parse(t.responseText);switch(!0){case e.errors.login&&/valid/.test(e.errors.login[0]):case e.errors.base&&/authentication/.test(e.errors.base[0]):this.alertLoginIssue("credentials");break;case e.errors.login&&/blank/.test(e.errors.login[0]):this.alertLoginIssue("login");break;case e.errors.password&&/valid|blank/.test(e.errors.password[0]):this.alertLoginIssue("password");break;case e.errors.base&&/confirmed/.test(e.errors.base[0]):this.alertLoginIssue("confirmation");break;default:this.alertLoginIssue()}}.bind(this))}},alertLoginIssue:function(t){var e,i=function(){this.processingLogin=!1,this.loginButton.removeClass("spinner-active"),e&&e.removeClass("uhoh")}.bind(this);switch(t){case"credentials":e=this.emailInput.add(this.passwordInput);break;case"login":e=this.emailInput;break;case"password":e=this.passwordInput;break;case"confirmation":var s=new Stage.modal({title:"Could not log in",content:'<div class="modal-padding rte"><p>It looks like your account hasn\'t been confirmed. Did the email end up in the spam folder?</p></div>'});s.render();break;default:this._.modules.site.errorModal(null,"Returned login error does not match any known conditions.")}return e?(e.addClass("uhoh").one("animationend webkitAnimationEnd",i),void 0):i()}}),Stage.registerModule("header.cart",{el:$("#header-cart-grouper"),initialize:function(){this.moreListItem=this.$("#header-cart-more-item"),this.el.on("click",".header-cart-item-remove",this.removeCartItem.bind(this))},addProduct:function(t,e,i){var s=$.get("/market/cart/add/"+t+".json?p="+e);s.done(function(t){this.insertCartItem(t),i(t)}.bind(this)),s.fail(function(t){this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))},insertCartItem:function(t){var e=t.price>0?this._.helpers.centsToMoney(t.price,!0):"Free";this.moreListItem.before('<li class="header-cart-item"><div class="header-cart-item-info"><h4 class="header-cart-item-title">'+t.name+" <span>by "+t.author.market_name+'</span></h4><p class="header-cart-item-subline">'+t.package+" – "+e+'</p></div><span class="header-cart-item-remove" data-id="'+t.id+'" data-p="'+t.package_id+'">×</span></li>'),this.el.attr("data-count",Number(this.el.attr("data-count"))+1)},removeCartItem:function(t){var e=$(t.target),i=e.closest(".header-cart-item");this.el.attr("data-count",Number(this.el.attr("data-count"))-1),i.remove();var s=$.get("/market/cart/remove/"+e.attr("data-id")+".json?p="+e.attr("data-p"));s.fail(function(){this._.modules.site.errorModal(jqXHR.status,jqXHR.statusText)}.bind(this))},removeCart:function(){this.el.remove()}}),Stage.registerModule("header",{el:$("#header-container"),initialize:function(){var t=function(){return("ontouchstart"in window||navigator.maxTouchPoints)===!0}();this.subNavigation=this.$("#header-sub-navigation-container"),this.searchContainer=this.$("#header-search-container"),this.searchField=this.$("#header-search-field"),this.body=$(document.body),this.subNavigation.length&&this.el.addClass("with-sub-navigation"),this.revealBar(),this.$("#mobile-menu-toggle").on("click",this.toggleMobileMenu.bind(this)),this.$("#search-toggle").on("click",this.toggleSearch.bind(this)),this.$(".toggle-login").on("click",this.toggleLogin.bind(this)),t?this.body.on("click",".header-drop-navigation-container",this.showDropNav.bind(this)):this.body.on("mouseenter",".header-drop-navigation-container",this.showDropNav.bind(this)),this.body.on("mouseleave",".header-drop-navigation-container",this.closeDropNav.bind(this))},revealBar:function(t){$.revealbar.destroy(),this.$("#site-header").revealbar({bottomOffset:null!=t?t:this.subNavigation.length?50:0,onDetach:function(){this.body.addClass("header-fixed")}.bind(this),onAttach:function(){this.body.removeClass("header-fixed")}.bind(this)})},showDropNav:function(t){var e=$(t.target).is(".header-drop-navigation-container")?$(t.target):$(t.target).closest(".header-drop-navigation-container");"click"===t.type?(null!=e.attr("data-active-size")?window.innerWidth>e.attr("data-active-size")&&t.preventDefault():$(t.target).closest(".header-drop-navigation").length||t.preventDefault(),e.find(".header-drop-navigation").toggleClass("navigation-active")):e.find(".header-drop-navigation").addClass("navigation-active")},closeDropNav:function(t){var e=$(t.target).is(".header-drop-navigation-container")?$(t.target):$(t.target).closest(".header-drop-navigation-container");e.find(".header-drop-navigation").removeClass("navigation-active")},toggleMobileMenu:function(){this.body.toggleClass("mobile-menu-active")},toggleSearch:function(){this.body.toggleClass("header-search-active"),this.body.hasClass("header-search-active")&&this.searchContainer.one("transitionend webkitTransitionEnd",function(){this.searchContainer.off("transitionend webkitTransitionEnd"),this.searchField.focus()}.bind(this))},toggleLogin:function(t){t&&t.preventDefault(),this._.modules["header.account"].toggleLogin()}}),Stage.registerModule("header.sub-nav",{el:$("#header-sub-navigation-container"),initialize:function(){this.navigationItems=[],this.itemsList=this.$("#sub-navigation-list-items"),this.visibleItemsContainer=this.itemsList.children("#sub-navigation-visible-items"),this.additionalItemsContainer=this.itemsList.children("#sub-navigation-additional-items"),this.viewMoreToggle=this.$("#sub-navigation-view-more"),this.visibleItemsContainer.find("li").each(function(t,e){e=$(e),e.attr("data-id",t),this.navigationItems.push({item:e,width:e.outerWidth(!0)})}.bind(this)),this.$("#sub-navigation-view-more").on("click",this.toggleSubNavAdditionalItems.bind(this)),this.$("#mobile-sub-navigation-toggle").on("click",this.toggleMobileSubNav.bind(this)),$(window).on("resize",this.arrangeNavigationItems.bind(this)).trigger("resize")},arrangeNavigationItems:function(){var t=this.itemsList.width();this.navigationItems.every(function(e,i,s){var a=s.length-(s.length-i),o=s.slice(0,a+1),n=o.map(function(t){return t.width}).reduce(function(t,e){return t+e});if(n>t-40){this.el.addClass("has-additional-items"),o.pop();var r=o,d=s.slice(a,s.length);return this.visibleItemsContainer.html(""),this.visibleItemsContainer.append(r.map(function(t){return t.item})),this.additionalItemsContainer.html(""),this.additionalItemsContainer.append(d.map(function(t){return t.item})),!1}return this.el.removeClass("has-additional-items"),this.visibleItemsContainer.html(""),this.visibleItemsContainer.append(this.navigationItems.map(function(t){return t.item})),!0}.bind(this))},toggleSubNavAdditionalItems:function(){this.viewMoreToggle.text("More"===this.viewMoreToggle.text()?"Less":"More"),this.el.toggleClass("additional-items-visible")},toggleMobileSubNav:function(){this.el.toggleClass("mobile-sub-navigation-visible")}}),Stage.registerModule("helpers",{moneyToCents:function(t){t=t.toString();var e=t.split("."),i=0;return e[1]&&(i=parseInt(e[1])),i+100*parseInt(e[0])},centsToMoney:function(t,e){var i=parseInt(t)/100,s=-1!=String(i).indexOf(".");return(e?"$":"")+(s?i.toFixed(2):i)},postalCodeTaxes:function(t){var e;switch(t){case"a":e={amount:13,type:"HST",name:"Newfoundland and Labrador"};break;case"b":e={amount:15,type:"HST",name:"Nova Scotia"};break;case"c":e={amount:15,type:"GST",name:"Prince Edward Island"};break;case"e":e={amount:13,type:"HST",name:"New Brunswick"};break;case"g":case"h":case"j":e={amount:5,type:"GST",name:"Quebec"};break;case"k":case"l":case"m":case"n":case"p":e={amount:13,type:"HST",name:"Ontario"};break;case"r":e={amount:5,type:"GST",name:"Manitoba"};break;case"s":e={amount:5,type:"GST",name:"Saskatchewan"};break;case"t":e={amount:5,type:"GST",name:"Alberta"};break;case"v":e={amount:5,type:"GST",name:"British Columbia"};break;case"x":e={amount:5,type:"GST",name:"Northwest Territories and Nunavut"};break;case"y":e={amount:5,type:"GST",name:"Yukon"};break;default:e={amount:0,type:"error",name:"Incorrect postal code value"}}return e},checkPostalCode:function(t){var e=function(t){return t.replace(/ |-/gi,"").toLowerCase()},i=function(t){var e=t.split(""),i=6===e.length,s=/^[a-z]+$/.test([e[0],e[2],e[4]].join("")),a=/^\d+$/.test([e[1],e[3],e[5]].join(""));return i&&s&&a},s=e(t);return i(s)?this.postalCodeTaxes(s.charAt(0)):null},escapeHTML:function(t){var e=document.createElement("textarea");return e.textContent=t,e.innerHTML}}),Stage.registerModule("hover-card",{el:$(document.body),initialize:function(){this.intentTimer,this.exitTimer,this.currentCard,this.el.on("mouseenter","[data-card]",function(t){this.intentTimer=setTimeout(function(){this.launchCard(t)}.bind(this),200)}.bind(this)),this.el.on("mouseleave","[data-card]",function(){clearTimeout(this.intentTimer)}.bind(this))},cardTemplate:function(){var t,e,i,s,a;return t=$('<div class="hover-card-container is-placeholder" />'),i="<div class='hover-card-portrait'><img data-placeholder='portrait' /></div>",i+="<div class='hover-card-info-container'>",i+="<h1 class='hover-card-user-name' data-placeholder='name'>Placeholder</h1>",i+="<p class='hover-card-user-job' data-placeholder='job'>Placeholder</p>",i+="</div>",e=$('<div class="hover-card-top" />').append(i),a="<div class='hover-card-content-group'><span class='hover-card-content-block' data-placeholder='karma'>0</span><span class='hover-card-content-label'>Karma</span></div>",a+="<div class='hover-card-content-group'><span class='hover-card-content-block' data-placeholder='comment_count'>0</span><span class='hover-card-content-label'>Comments</span></div>",a+="<div class='hover-card-content-group'><span class='hover-card-content-block' data-placeholder='post_count'>0</span><span class='hover-card-content-label'>Stories</span></div>",s=$('<div class="hover-card-bottom" />').append(a),t.append(e).append(s),t},launchCard:function(t){var e=$(t.target),i=e.is("[data-card]")?e:e.closest("[data-card]"),s=i[0].getBoundingClientRect(),a=i.attr("data-card");i.on("mouseleave",this.destroyCurrentCard.bind(this)),this.currentCard&&this.destroyCurrentCard();var o=this.cardTemplate();this.currentCard=o,this.el.append(o);var n=document.body.scrollTop+s.top-o.outerHeight()-10,r=document.body.scrollTop+s.top+s.height+10,d=n<document.body.scrollTop;o.css({top:d?r:n,left:s.left+s.width/2-o.width()/2}).addClass(d?"bottom-position":"top-position"),setTimeout(function(){o.addClass("visible")},100);var l=$.get("/users/"+a+".json");l.done(function(t){o.find("[data-placeholder='portrait']").attr("src","/users/"+t.id+"/portrait"),o.find("[data-placeholder='name']").text(t.names.full),o.find("[data-placeholder='job']").text(t.job),o.find("[data-placeholder='karma']").text(t.karma),o.find("[data-placeholder='comment_count']").text(t.comment_count),o.find("[data-placeholder='post_count']").text(t.post_count),setTimeout(function(){o.removeClass("is-placeholder")},50)})},destroyCurrentCard:function(){this.currentCard&&this.currentCard.remove(),this.currentCard=null}}),Stage.registerModule("imgix",{initialize:function(){this.imgixDomain=config.imgix_domain,this.awsDomain=config.aws_domain},generate:function(t,e){var i=t.replace(this.awsDomain,this.imgixDomain);return i+"?"+$.param(e)}}),Stage.registerModule("jobs",{el:$(".job-listings-index"),initialize:function(){this.$(".job-listing-delete-job").on("click",this.deleteJob.bind(this))},deleteJob:function(t){t.preventDefault();var e='<div class="modal-padding rte" id="delete-content-model">';e+="<p>Are you sure you want to delete this job? It cannot be undone and does not qualify for a refund.</p>",e+='<button id="confirm-delete-job" class="standard-button outline">Yes, delete this job.</button>',e+="</div>";var i=new Stage.modal({title:"Delete this job.",content:e}),s=function(){var e=$.ajax({url:"/jobs/"+$(t.target).attr("data-id"),type:"DELETE"});e.done(function(){return window.location="/jobs"}),e.fail(function(t){i.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))};t.preventDefault(),i.render(),i.content.on("click","#confirm-delete-job",s.bind(this))}}),Stage.registerModule("jobs.new",{el:$(".job-listings-new"),initialize:function(){this.jobForm=this.$("#job-listing-form"),this.logoField=this.$("#job_listing_company_logo"),this.logoPreview=this.$("#new-job-logo-preview"),this.featuredCheckbox=this.$("#job_listing_featured"),this.postalCodeField=this.$("#job_listing_postal_code"),this.couponLink=this.$("#coupon-prompt-link"),this.creditCardFields=this.$("#credit-card-container"),this.stripeErrorMessage=this.$("#new-job-stripe-error"),this.submitButton=this.$("#job-submit-button"),this.stripeTokenField=this.$("#stripe-token"),this.couponIDField=this.$("#coupon-id"),this.discountAmountField=this.$("#job_listing_discount_amount"),this.taxAmountField=this.$("#job_listing_tax_amount"),this.chargeAmountField=this.$("#charge-amount"),this.cartSections=this.$(".sidebar-cart-layout [data-section]"),this.cartValues=this.$(".sidebar-cart-layout [data-value]"),this.hasStripeToken=this.creditCardFields.hasClass("existing-card"),Stripe.setPublishableKey(payment.stripe_key),this.updateTotal(),this.logoField.on("change",this.updateCompanyLogo.bind(this)),this.featuredCheckbox.on("change",this.updateFeaturedState.bind(this)),this.postalCodeField.on("input",this.updatePostalCode.bind(this)),this.couponLink.on("click",this.launchCouponRedeem.bind(this)),this.$("#remove-credit-card").on("click",this.removeCreditCard.bind(this)),this.jobForm.on("submit",this.submitListing.bind(this))},updateCompanyLogo:function(){var t=this.logoField[0].files,e=new FileReader;e.onload=function(t){this.logoPreview.addClass("has-image").css("background-image","url("+t.target.result+")")}.bind(this),t.length?e.readAsDataURL(t[0]):this.logoPreview.removeClass("has-image").css("background-image","")},updateFeaturedState:function(){this.isFeatured=this.featuredCheckbox.is(":checked"),this.cartSections.filter('[data-section="featured"]').toggleClass("hidden",!this.isFeatured),this.updatePostalCode(),this.updateTotal()},updatePostalCode:function(){var t=this.postalCodeField.val(),e=this._.helpers.checkPostalCode(t),i=this.cartSections.filter('[data-section="tax"]'),s=this.getTotal(!0);e?(this.taxAmount=s*.01*e.amount,this.taxAmountField.val(this._.helpers.centsToMoney(this.taxAmount)),this.cartValues.filter('[data-value="subtotal"]').text(this._.helpers.centsToMoney(s,!0)),this.cartValues.filter('[data-value="tax-type"]').text(e.amount+"% "+e.type),this.cartValues.filter('[data-value="tax-amount"]').text(this._.helpers.centsToMoney(this.taxAmount,!0)),this.updateTotal(),i.removeClass("hidden")):(i.addClass("hidden"),this.taxAmount=0,this.taxAmountField.val(""),this.updateTotal())},launchCouponRedeem:function(t){t.preventDefault();var e='<div class="modal-padding rte" id="redeem-coupon-modal">';e+="<p>Have a coupon for a job listing? Enter the code below to redeem it:</p>",e+='<p id="no-bueno-coupon-code" class="notice-text"> That coupon didn\'t seem to work.</p>',e+='<input type="text" class="standard-text-field" id="coupon-code-field" />',e+='<button id="submit-coupon-code" class="standard-button outline">Redeem.</button>',e+="</div>";var i=new Stage.modal({title:"Redeem coupon.",content:e,onRender:function(){setTimeout(function(){i.$("#coupon-code-field").focus()},100)},onExit:function(){i.content.removeClass("coupon-didnt-work")}}),s=function(){var t=i.$("#coupon-code-field"),e=t.val();if(!e.length)return t.addClass("error").focus();var s=$.get("/jobs/coupon?code="+encodeURI(e));s.done(function(t){return 0==t.success?(i.content.addClass("coupon-didnt-work"),void 0):(this.couponIDField.val(t.coupon.id),this.discountAmountField.val(t.coupon.amount),this.discountAmount=100*t.coupon.amount,this.cartValues.filter('[data-value="coupon-amount"]').text("-"+this._.helpers.centsToMoney(100*t.coupon.amount,!0)),this.cartValues.filter('[data-value="coupon-code"]').text(t.coupon.code.toUpperCase()),this.cartSections.filter('[data-section="coupon"]').removeClass("hidden"),this.couponLink.remove(),i.exit(),this.updatePostalCode(),this.updateTotal(),void 0)}.bind(this)),s.fail(function(t){i.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))};t.preventDefault(),i.render(),i.content.on("click","#submit-coupon-code",s.bind(this))},getTotal:function(t){var e=100*payment.base_price,i=100*payment.promoted_price,s=this.taxAmount||0;return e+(this.isFeatured?i:0)-(this.discountAmount||0)+(t?0:s)},updateTotal:function(){var t=this.getTotal(),e=this.cartValues.filter('[data-value="total"]');e.text(this._.helpers.centsToMoney(t,!0)),this.chargeAmountField.val(this._.helpers.centsToMoney(t))},removeCreditCard:function(){var t=$.get("/me/forget_payment_information");t.done(function(){location.reload()})},submitListing:function(t){this.hasStripeToken||(t.preventDefault(),this.stripeErrorMessage.removeClass("visible"),this.submitButton.addClass("spinner-active"),this.creditCardFields.processStripe({success:function(t){this.stripeTokenField.val(t),this.hasStripeToken=!0,this.jobForm.submit()}.bind(this),error:function(t){this.stripeErrorMessage.text(t).addClass("visible"),this.submitButton.removeClass("spinner-active")}.bind(this)}))}}),Stage.registerModule("modal",{asClass:!0,el:$(document.body),initialize:function(t){return this._options=$.extend({size:"medium",content:"",title:"Someone didn't set a title",onRender:null,onExit:null},t),this.isOpen=!1,this.modal=function(){var t=$('<div class="modal-wrapper" />'),e=$('<div class="modal-overlay" />'),i=$("<div />").attr({"class":"modal-container size-"+this._options.size});return i.append($('<header class="modal-content-header" />').html("<h2>"+this._options.title+"</h2>")),$("<button />").attr({"class":"modal-close-button","data-modal":"close"}).html("&#215;").appendTo(i),i.append(this._options.content),t.append(e).append(i),this.overlay=e,this.content=i,this.$=function(t){return i.find(t)},t}.call(this),this},render:function(){this.el.append(this.modal),setTimeout(function(){this._options.onRender&&this._options.onRender(),this.overlay.on("click",this.exit.bind(this)),this.modal.find('[data-modal="close"]').on("click",this.exit.bind(this)),this.isOpen=!0,this.modal.addClass("modal-visible"),this.el.addClass("lock-scroll")}.bind(this),0)},exit:function(){this.modal.removeClass("modal-visible").one("transitionend webkitTransitionEnd",function(){this.modal.off("transitionend webkitTransitionEnd"),this.modal.remove(),this.isOpen=!1,this._options.onExit&&this._options.onExit(),this.el.removeClass("lock-scroll")}.bind(this))}}),Stage.registerModule("motd",{el:$("#feed-motd-container"),initialize:function(){this.id=this.el.attr("data-id"),this.motdEditTextArea=this.$("#motd_message"),this.voteContainer=this.$("#feed-motd-vote-controls"),this.pointsUp=this.$("#feed-motd-score-up"),this.pointsDown=this.$("#feed-motd-score-down"),this.$("#toggle-motd-edit").on("click",this.toggleMotdEdit.bind(this)),this.$('[class*="vote-arrow"]').on("click",this.motdVote.bind(this))},toggleMotdEdit:function(t){t&&t.preventDefault(),this.el.toggleClass("update-motd-visible"),setTimeout(function(){this.el.hasClass("update-motd-visible")&&this.motdEditTextArea.focus()}.bind(this),200)},motdVote:function(t){var e=$(t.target),i=e.attr("data-direction"),s=$.post("/motd/"+i+"vote.json","motd_id="+this.id),a="up"==i?this.pointsUp:this.pointsDown,o=parseInt(a.text()),n="up"==i?o+1:o-1;a.text("up"==i?"+"+n:n),this.voteContainer.remove(),s.fail(function(t){this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))}}),Stage.registerModule("products.form-media",{el:$("#product-section-media"),initialize:function(){var t=this;this.mediaListContainer=this.$("#product-media-list-container"),this.uploadField=this.$("#media-upload-input_"),this.uploadedItems={},this.awsData=this.el.attr("data-aws-data"),this.awsURL=this.el.attr("data-aws-url"),this.awsHost=this.el.attr("data-aws-host"),this.mediaListContainer.sortable().bind("sortupdate",this.updateThumbnailLabel.bind(this)),this.el.fileupload({fileInput:this.uploadField,url:this.awsURL,formData:JSON.parse(this.awsData),type:"POST",autoUpload:!0,paramName:"file",dataType:"XML",replaceFileInput:!1,add:function(e,i){var s=i.files[0],a=s.type.split("/")[0].toLowerCase(),o=s.name.replace(/ /g,"_");if(0==/(\.|\/)(gif|jpg|png|jpeg|mp4)$/.test(s.name)){var n='<div class="modal-padding rte">';n+="<p>Please choose a GIF, JPG, PNG, or MP4 file.</p>",n+="</div>";var r=new Stage.modal({title:"Incorrect file type.",content:n});return r.render()}var d=$('<div class="product-media-item-container" />');d.attr("data-type",a),$('<span class="product-media-filename" />').appendTo(d),t.mediaListContainer.append(d),t.mediaListContainer.sortable("reload"),t.uploadedItems[o]=d,i.submit()},progress:function(e,i){var s=i.files[0],a=s.name.replace(/ /g,"_"),o=t.uploadedItems[a],n=parseInt(100*(i.loaded/i.total),10);o.children(".product-media-filename").text(n+"% uploaded...")},done:function(e,i){var s=i.files[0],a=s.name.replace(/ /g,"_"),o=t.uploadedItems[a],n=o.attr("data-type"),r=new FileReader,d=$(i.jqXHR.responseXML).find("Key").text(),l="//"+t.awsHost+"/"+d;r.onload=function(t){o.css("background-image","url("+t.target.result+")")},o.children(".product-media-filename").text(a),"image"===n?r.readAsDataURL(s):"video"===n&&o.prepend('<svg aria-label="video" class="product-media-video-svg" height="30" id="svg-video" role="img" version="1.1" viewBox="0 0 46 30" width="46"><path d="m35.778 11.25v-8.75c0-1.375-1.15-2.5-2.556-2.5h-30.667c-1.406 0-2.556 1.125-2.556 2.5v25c0 1.375 1.15 2.5 2.556 2.5h30.667c1.406 0 2.556-1.125 2.556-2.5v-8.75l10.222 10v-27.5l-10.222 10"></path></svg>'),t.updateThumbnailLabel(),t.setupMediaHTML(o,{url:l,name:a,type:n})},fail:function(e,i){var s=i.files[0],a=s.name.replace(/ /g,"_"),o=t.uploadedItems[a];o.remove(),t._.modules.site.errorModal(i.jqXHR.status,i.jqXHR.statusText)}}),this.el.on("click",".product-remove-item-button",this.removeMedia.bind(this))},setupMediaHTML:function(t,e){$('<button class="product-remove-item-button" />').text("×").appendTo(t),$("<input />").attr({type:"hidden",name:"product[media][][type]",value:e.type}).appendTo(t),$("<input />").attr({type:"hidden",name:"product[media][][name]",value:e.name}).appendTo(t),$("<input />").attr({type:"hidden",name:"product[media][][url]",value:e.url}).appendTo(t)},updateThumbnailLabel:function(){var t=this.$(".product-media-item-container");t.removeClass("is-thumb"),t.filter('[data-type="image"]').first().addClass("is-thumb")},removeMedia:function(t){$(t.target).parent().remove(),this.updateThumbnailLabel()}}),Stage.registerModule("products.form-packages",{el:$("#product-section-packages"),initialize:function(){var t=this;this.packagesListContainer=this.$("#product-packages-list-container"),this.uploadField=this.$("#package-upload-input_"),this.uploadedItems={},this.awsData=this.el.attr("data-aws-data"),this.awsURL=this.el.attr("data-aws-url"),this.awsHost=this.el.attr("data-aws-host"),this.packagesListContainer.sortable(),this.el.fileupload({fileInput:this.uploadField,url:this.awsURL,formData:JSON.parse(this.awsData),type:"POST",autoUpload:!0,paramName:"file",dataType:"XML",replaceFileInput:!1,add:function(e,i){var s=i.files[0],a=s.name.replace(/ /g,"_");if(0==/(\.|\/)(zip)$/.test(s.name)){var o='<div class="modal-padding rte">';o+="<p>Please choose a ZIP file.</p>",o+="</div>";var n=new Stage.modal({title:"Incorrect file type.",content:o});return n.render()}var r=$('<div class="product-package-item-container" />');
r.text("Uploading..."),t.packagesListContainer.append(r),t.packagesListContainer.sortable("reload"),t.uploadedItems[a]=r;var d=Number(s.size/1e9).toFixed(1);d>1&&alert('The file "'+a+'" is '+d+"GB in size. Do not close this page while it uploads. You may encounter upload issues; if so, please upload a temporary file (such as a small image, just so you can save), and reach out to us so we can assist you."),i.submit()},progress:function(e,i){var s=i.files[0],a=s.name.replace(/ /g,"_"),o=t.uploadedItems[a],n=parseInt(100*(i.loaded/i.total),10);o.text(n+"% uploaded...")},done:function(e,i){var s=i.files[0],a=s.name.replace(/ /g,"_"),o=t.uploadedItems[a],n=$(i.jqXHR.responseXML).find("Key").text(),r="//"+t.awsHost+"/"+n;t.setupPackageHTML(o,{url:r,name:a,size:s.size})},fail:function(e,i){var s=i.files[0],a=s.name.replace(/ /g,"_"),o=t.uploadedItems[a];o.remove(),t._.modules.site.errorModal(i.jqXHR.status,i.jqXHR.statusText)}}),this.el.on("click",".product-remove-item-button",this.removePackage.bind(this)),this.el.on("input",".product-package-item-price",this.updatePackagePrice.bind(this))},setupPackageHTML:function(t,e){t.text(""),$('<button class="product-remove-item-button" />').text("×").appendTo(t),$('<p class="product-package-item-filename" />').html("<span>File: </span> "+e.name).appendTo(t);var i=$('<div class="product-package-item-top-grouper" />');$("<input />").attr({type:"text",name:"product[packages][][title]",placeholder:"Title of this package",required:"required","class":"standard-text-field product-package-item-name"}).appendTo(i);var s=$('<div class="product-package-item-price-grouper" />');$('<span class="product-package-item-price-currency" />').text("$").appendTo(s),$("<input />").attr({type:"text",value:"0.00",placeholder:"0.00",required:"required","class":"standard-text-field product-package-item-price"}).appendTo(s),s.appendTo(i),i.appendTo(t),$("<textarea />").attr({"class":"standard-text-area product-package-item-description",required:"required",name:"product[packages][][description]",placeholder:"Short description of this package"}).appendTo(t),$("<input />").attr({"class":"package-price-value",type:"hidden",name:"product[packages][][price]",value:0}).appendTo(t),$("<input />").attr({type:"hidden",name:"product[packages][][file][url]",value:e.url}).appendTo(t),$("<input />").attr({type:"hidden",name:"product[packages][][file][name]",value:e.name}).appendTo(t),$("<input />").attr({type:"hidden",name:"product[packages][][file][size]",value:e.size}).appendTo(t)},updatePackagePrice:function(t){var e=$(t.target),i=Number(e.val()),s=$(t.target).closest(".product-package-item-container").find(".package-price-value"),a=1==/^[1-9]\d*(((,\d{3}){1})?(\.\d{0,2})?)$/.test(i);s.val(a?this._.modules.helpers.moneyToCents(i):"")},removePackage:function(t){$(t.target).parent().remove()}}),Stage.registerModule("products.form",{el:$(".products-new, .products-edit").first(),initialize:function(){this.productForm=this.$(".edit-product-form"),this.submitButton=this.productForm.find("#product-submit-button"),this.newFeaturePrompt=this.productForm.find("#new-feature-prompt"),this.addNewfeatureButton=this.productForm.find("#create-new-feature-button"),this.featureListContainer=this.productForm.find("#product-features-list-container"),this.mediaListContainer=this.productForm.find("#product-media-list-container"),this.packagesListContainer=this.productForm.find("#product-packages-list-container"),this.featureListContainer.sortable(),this.productForm.on("submit",this.updateProduct.bind(this)),this.newFeaturePrompt.on("keypress",this.addNewFeatureItem.bind(this)),this.addNewfeatureButton.on("click",this.addNewFeatureItem.bind(this)),this.el.on("click",".remove-product-feature-button",this.removeFeatureItem.bind(this))},addNewFeatureItem:function(t){var e;if("string"==typeof t?e=t:"keypress"===t.type&&13===t.which?(t.preventDefault(),e=this.newFeaturePrompt.val()):"keypress"!==t.type&&(e=this.newFeaturePrompt.val()),e&&e.length){var i=$('<div class="product-feature-container" />');$('<span class="remove-product-feature-button standard-button outline" />').text("×").appendTo(i),$("<input />").attr({type:"text","class":"standard-text-field",name:"product[features][]",value:e}).appendTo(i),this.newFeaturePrompt.val("").focus(),this.featureListContainer.append(i).sortable("reload")}},removeFeatureItem:function(t){$(t.target).parent().remove()},updateProduct:function(t){t.preventDefault(),this.submitButton.addClass("spinner-active");var e=this.mediaListContainer.children(),i=this.$(".package-price-value"),s=[];if(this.featureListContainer.children().length||s.push("Please provide at least one product Feature item"),e.length||s.push("Please provide at least one product Media item"),this.packagesListContainer.children().length||s.push("Please provide at least one product Package item"),e.filter('[data-type="image"]').length||s.push("At least one media item needs to be an image for the thumbnail"),0==$.makeArray(i).every(function(t){return $(t).val().length})&&s.push("Please ensure all package prices contain a valid dollar amount."),s.length){var a='<div class="modal-padding rte">';a+="<p>We found the following issues:</p><ul>",s.forEach(function(t){a+="<li>"+t+"</li>"}),a+="</ul></div>";var o=new Stage.modal({title:"Couldn't submit product.",content:a});return this.submitButton.removeClass("spinner-active"),o.render()}var n=$.post(this.productForm.attr("action"),this.productForm.serialize());n.done(function(t){window.location="/market/"+t.id+"/edit"}),n.fail(function(t){this.submitButton.removeClass("spinner-active"),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))}}),Stage.registerModule("products",{el:$(document.body),initialize:function(){this.el.on("click",".product-listing-item-overlay .standard-button",this.triggerQuickView.bind(this))},triggerQuickView:function(t){t.preventDefault();var e=$(t.target).closest(".product-listing-item").attr("data-id"),i=$.get("/market/"+e+".json");i.done(function(t){var e='<div class="product-quick-view-container">';e+='<div class="product-quick-view-image" style="background-image:url(\''+this._.modules.imgix.generate(t.media[0].url,{h:245,w:660,blur:100})+"')\">",e+='<p class="product-quick-view-description">'+t.short_description+"</p>",e+="</div>",e+='<div class="product-quick-view-actions">',e+='<span class="product-quick-view-author">From '+t.author.market_name+"</span>",e+='<a href="/market/'+t.id+'" class="standard-button outline product-quick-view-button">Starting at '+this._.modules.helpers.centsToMoney(t.base_price,!0)+"</a>",e+="</div>",e+='<ul class="product-quick-view-features">',t.features.forEach(function(t){e+="<li>"+t+"</li>"}),e+="</ul>",e+="</div>";var i=new Stage.modal({title:t.title,size:"medium",content:e});return i.render()}.bind(this)),i.fail(function(t){modal.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))}}),Stage.registerModule("products.show",{el:$(".products-show"),initialize:function(){this.header=this.$("#header-container"),this.infoContainer=this.$("#product-page-info-main"),this.mediaContainer=this.$("#product-page-media"),this.shareProductContainer=this.$("#product-share-container"),this.shareProductList=this.$("#product-share-items"),this.shareData={name:this.shareProductList.attr("data-name"),author:this.shareProductList.attr("data-author"),url:encodeURI(this.shareProductList.attr("data-url")),tags:this.shareProductList.attr("data-tags").replace(/ /g,"-").toLowerCase()},/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&this.mediaContainer.addClass("no-video-controls"),$(window).on("resize",this.adjustProductComponents.bind(this)).trigger("resize"),$(window).on("scroll",this.adjustMobileInfoBox.bind(this)).trigger("scroll"),this.el.on("click","[data-product]",this.productPurchaseIntent.bind(this)),this.el.on("click",".product-page-video-playback-button",this.toggleVideoPlayback.bind(this)),this.el.on("click","#product-page-more-toggle-container",this.toggleMobileExtraInfo.bind(this)),this.el.on("click","#product-share-button",this.toggleProductShare.bind(this)),this.shareProductList.on("click",".share-item",this.launchShare.bind(this))},adjustProductComponents:function(){window.innerWidth>767?(this.infoContainer.removeClass("can-fix"),this.header.addClass("with-sub-navigation"),this._.modules.header.revealBar()):(this.infoContainer.addClass("can-fix"),this.header.removeClass("with-sub-navigation"),this._.modules.header.revealBar(0))},adjustMobileInfoBox:function(){if(this.infoContainer.hasClass("can-fix")){var t=this.mediaContainer.offset().top+this.mediaContainer.outerHeight(),e=$(document).scrollTop()+window.innerHeight-this.infoContainer.outerHeight();this.infoContainer.toggleClass("fixed",t>=e)}},toggleMobileExtraInfo:function(t){t.preventDefault(),this.infoContainer.toggleClass("mobile-info-extras-visible")},productPurchaseIntent:function(t){t.preventDefault();var e=$(t.target),i=e.text(),s=e.attr("data-product"),a=e.attr("data-id"),o=function(t){this._.modules["header.cart"].addProduct(a,t,function(){e.text("Added to cart!"),setTimeout(function(){e.text(i)},2e3)})}.bind(this);if("add"===s){var n=e.attr("data-package");o(n)}else{var r=$('<div class="modal-padding rte" />');productPackages.forEach(function(t){var e=$('<div class="product-select-package-container rte" />');e.append($("<h3 />").html(t.title+"<span> &mdash; "+this._.modules.helpers.centsToMoney(t.price,!0)+"</span>")),e.append($("<p />").text(t.description)),e.append($('<button class="standard-button outline" />').attr({"data-product":"add","data-id":a,"data-package":t.index}).text("Choose this package")),r.append(e)}.bind(this));var d=new Stage.modal({title:"Select a package.",size:"large",content:r});d.render()}},toggleVideoPlayback:function(t){var e=$(t.target),i=e.siblings(".product-preview-video")[0],s=e.closest(".product-page-video-container");if(i.paused){var a=s.offset().top-window.innerHeight/2+s.height()/2;i.play(),s.addClass("video-playing"),$(document.body).addClass("lock-scroll"),$("html, body").animate({scrollTop:a},300)}else i.pause(),s.removeClass("video-playing"),$(document.body).removeClass("lock-scroll")},toggleProductShare:function(){this.shareProductContainer.toggleClass("share-active")},launchShare:function(t){t.preventDefault();var e=$(t.target).attr("data-share"),i=this.shareData,s={facebook:function(){return"https://www.facebook.com/sharer/sharer.php?s=100&p[url]="+i.url},twitter:function(){return"https://twitter.com/intent/tweet?text="+i.name+" by "+i.author+"&url="+i.url+"&hashtags="+i.tags+"&via=designernewsbot"},slack:function(){return"http://slackbutton.herokuapp.com/post/new/?url="+i.url},pinterest:function(){return"https://pinterest.com/pin/create/link/?url="+i.url+"&description="+i.name+" by "+i.author}};return window.open(s[e](),"_blank","width=500, height=400, menubar=no, status=no")}}),Stage.registerModule("reports",{el:$(".content-reports-index"),initialize:function(){this.$(".clear-report-link").on("click",this.toggleReportClear.bind(this))},toggleReportClear:function(t){t.preventDefault();var e=$(t.target),i=e.closest(".nevada-list-item"),s=i.attr("data-id"),a=$.post("/reports/"+s+"/clear");a.done(function(t){i.toggleClass("content-report-cleared",t.cleared),e.text(t.cleared?"Restore":"Clear report")})}}),Stage.registerModule("resizing-textarea",{asClass:!0,initialize:function(t){this.el=t,this.textarea=this.el.find(".resizing-textarea"),this.minHeight=this.el.hasClass("layout-style-compact")?36:125,this.previewContent=this.el.find(".markdown-preview-content"),this.previewToggle=this.el.find(".toggle-markdown-preview"),this.el.on("mouseenter",this.setMarkdownIntent.bind(this)),this.el.on("mouseleave",this.unsetMarkdownIntent.bind(this)),this.textarea.on("focus",this.textareaActive.bind(this)),this.textarea.on("blur",this.textareaInactive.bind(this)),this.textarea.on("input",this.updateTextareaHeight.bind(this)),this.previewToggle.on("click",this.toggleMarkdownPreview.bind(this)),this.el.on("click",".markdown-cheatsheet-toggle",this.toggleMarkdownCheatsheet.bind(this))},textareaActive:function(){this.el.addClass("active")},textareaInactive:function(){this.markdownIntent||this.textarea.val().length||this.el.removeClass("active")},updateTextareaHeight:function(){this.textarea.height("auto"),this.el.hasClass("layout-style-compact")&&!this.textarea.val().length?this.textarea.height(18):this.textarea.height(Math.max(this.textarea[0].scrollHeight,this.minHeight)-22)},setMarkdownIntent:function(){this.markdownIntent=!0},unsetMarkdownIntent:function(){this.markdownIntent=!1},toggleMarkdownCheatsheet:function(){window.innerWidth<768||($(document.body).hasClass("mdcs-visible")?$(document.body).removeClass("mdcs-visible"):($(document.body).addClass("mdcs-visible"),$(window).trigger("resize")))},toggleMarkdownPreview:function(){if(this.previewingMarkdown)this.el.removeClass("markdown-preview-visible"),this.previewToggle.text(this.previewToggle.data("alt")),this.previewingMarkdown=!1,this.textarea.focus();else{var t=markdown.toHTML(this.textarea.val());t.length||(t="<code>Nothing to preview<code>"),this.previewContent.html(t),this.el.addClass("markdown-preview-visible"),this.previewToggle.data("alt",this.previewToggle.text()),this.previewToggle.text("Continue editing"),this.previewingMarkdown=!0}}}),Stage.registerModule("shop-settings",{el:$(".users-manage-shop"),initialize:function(){this.userID=this.$("#manage-shop-header").attr("data-user-id"),this.saveSettingsButton=this.$("#save-shop-settings-button"),this.settingsForm=this.$(".edit_user"),this.activityForm=this.$("#manage-shop-activity-picker"),this.activityRangeStart=this.$("#manage-shop-activity-date-start"),this.activityRangeEnd=this.$("#manage-shop-activity-date-end"),this.activityContainer=this.$("#manage-shop-activity-container"),this.el.on("click","#delete-product",this.deleteProduct.bind(this)),this.settingsForm.on("submit",this.saveSettings.bind(this)),this.activityForm.on("submit",this.findActivity.bind(this))},deleteProduct:function(t){t.preventDefault();var e=$(t.target).closest(".manage-shop-product").attr("data-id"),i='<div class="modal-padding rte" id="delete-content-model">';i+="<p>Are you sure you want to delete this product? It cannot be undone.</p>",i+='<button id="confirm-delete-product" class="standard-button outline">Yes, delete this product.</button>',i+="</div>";var s=new Stage.modal({title:"Delete this product.",content:i}),a=function(){var t=$.ajax({url:"/market/"+e,type:"DELETE"});t.done(function(){return window.location.reload()}),t.fail(function(t){s.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))};t.preventDefault(),s.render(),s.content.on("click","#confirm-delete-product",a.bind(this))},saveSettings:function(t){t.preventDefault(),this.saveSettingsButton.addClass("spinner-active");var e=$.post(this.settingsForm.attr("action"),this.settingsForm.serialize());e.done(function(){return window.location.reload()}),e.fail(function(t){modal.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))},findActivity:function(t){t.preventDefault();var e=this.activityRangeStart.val(),i=this.activityRangeEnd.val();if(!e.length||!i.length)return alert("Please select start and end dates");var s=$.post("/users/"+this.userID+"/sales.json","date_start="+e+"&date_end="+i);s.done(function(t){if(t.purchases.length){var e="<h3>"+this._.helpers.centsToMoney(t.earned_net,!0)+" earned.</h3>";e+="<ul>",t.purchases.forEach(function(t){var i=$("<li />").html('<p class="market-activity-item-title">'+t.purchase_date+"</p>"),s=$('<ul class="activity-purchase-items" />');t.items.forEach(function(t){$("<li />").html(t.product_title+"<span>"+t.package_title+"</span>").appendTo(s)}),i.append(s),e+=i.html()}),e+="</ul>",this.activityContainer.html(e)}else this.activityContainer.html('<p id="no-shop-activity-label">No activity for the specified range.</p>')}.bind(this)),s.fail(function(t){this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))}}),Stage.registerModule("sidebar",{el:$("#page-sidebar-content"),initialize:function(){this.sidebarBlocks=this.$(".sidebar-block"),this.mobileBlocks=$(".mobile-sidebar-block"),setTimeout(this.setupMobileBlocks.bind(this),1e3),$(document.body).on("click",".mobile-sidebar-block-toggle-bar",this.toggleMobileSidebar.bind(this))},setupMobileBlocks:function(){this.sidebarBlocks.each(function(t,e){e=$(e);var i=this.mobileBlocks.filter('[data-mobile-sidebar="'+e.attr("data-sidebar-block")+'"]'),s=e.clone();s=$.parseHTML(s.html()),i.length&&(i.children(".mobile-sidebar-block-inner").html(s),"true"!==i.attr("data-mobile-sidebar-collapsed")&&i.addClass("visible"))}.bind(this))},toggleMobileSidebar:function(t){$(t.target).closest(".mobile-sidebar-block").toggleClass("visible")}}),Stage.registerModule("site",{el:$(document.body),initialize:function(){this.tabbedContent=this.$(".tabbed-content"),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(function(t){var e=!0,i=!1,s=void 0;try{for(var a,o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var n=a.value;n.unregister()}}catch(r){i=!0,s=r}finally{try{!e&&o.return&&o.return()}finally{if(i)throw s}}}),this.tabbedContent.length&&this.setUpTabs(),this.$(".resizing-text-area-container").each(function(t,e){new this._.modules["resizing-textarea"]($(e))}.bind(this)),this.el.on("submit","form",this.checkFormValidity.bind(this)),this.el.on("keydown","textarea, input",this.checkForSubmit.bind(this)),this.$(".date-select").each(function(t,e){calendar.set(e)}),this.el.on("change","select",this.updateSelect.bind(this)),this.el.on("click",".password-field-visibility-toggle",this.togglePasswordVisibility.bind(this))},updateSelect:function(t){var e=$(t.target),i=e.siblings(".select-label");i.text(e.find(":checked").text())},checkForSubmit:function(t){if((t.metaKey||t.ctrlKey)&&13==t.keyCode){var e=$(t.target).closest("form");e.length&&e.submit()}},setUpTabs:function(){this.tabItems=this.tabbedContent.find("li[data-tab]"),this.tabPanels=this.tabbedContent.find(".tabbed-content-panel"),this.tabItems.on("click",this.toggleTab.bind(this)),window.location.hash&&/tab-/.test(window.location.hash)&&this.toggleTab(null,window.location.hash.replace("#tab-",""))},toggleTab:function(t,e){if(t){var i=$(t.target),e=i.data("tab");history.pushState(null,null,"#tab-"+e)}else var i=this.tabItems.filter('[data-tab="'+e+'"]');this.tabItems.removeClass("active"),this.tabPanels.removeClass("active").filter('[data-tab="'+e+'"]').addClass("active"),i.addClass("active")},togglePasswordVisibility:function(t){var e=$(t.target),i=e.siblings("input");e.toggleClass("active").text("Reveal"===e.text()?"Hide":"Reveal"),i.attr("type","password"===i.attr("type")?"text":"password")},errorModal:function(t,e){var i;i='<div class="modal-padding rte">',i+='<p>Something, somewhere along the line, messed up. Would you mind sending us an email? <a href="mailto:hello@designernews.co">hello@designernews.co</a>.</p>',t&&(i+="<p>The status code is <b>"+t+"</b>"+(e?" and the error message is:":".")+"</p>"),e&&(i+="<blockquote>"+e+"</blockquote>"),i+="<small>Your browser's console may reveal more information about this error, and browser/operating system is always helpful, so feel free to send those our way if possible.</small>",i+="</div>";var s=new Stage.modal({title:"Sorry, there was an error.",content:i});s.render()},checkFormValidity:function(t){var e=$(t.target).find("[required]"),i=[];e.each(function(t,e){e.checkValidity()||i.push($(e))}),i.length&&(t.preventDefault(),i.forEach(function(t){t.addClass("error")}))}}),Stage.registerModule("stories.form",{el:$(".stories-new, .stories-edit").first(),initialize:function(){if(this.storyForm=this.$("#story-form"),this.submitButton=this.storyForm.find("#story-submit-button"),this.titleField=this.storyForm.find("#story-title-field"),this.urlField=this.storyForm.find("#story-url-field"),this.commentField=this.storyForm.find("#story-comment-field"),this.sponsoredCheckbox=this.storyForm.find("#story_sponsored"),this.sponsoredDate=this.storyForm.find("#sponsored-story-date-field"),this.duplicateWarnContainer=this.storyForm.find("#new-story-duplicate-container"),this.storyBadges=this.$(".story-prompt-badge"),this.titleField.attr("data-placeholder",this.titleField.attr("placeholder")),this.urlField.attr("data-placeholder",this.urlField.attr("placeholder")),this.commentField.attr("data-placeholder",this.commentField.attr("placeholder")),this.storyForm.on("submit",this.submitStory.bind(this)),this.urlField.on("input",this.checkContentInputs.bind(this)).trigger("input"),this.commentField.on("input",this.checkContentInputs.bind(this)).trigger("input"),this.sponsoredCheckbox.on("change",this.updateSponsoredDate.bind(this)),this.storyBadges.on("mouseenter",this.showBadgePrompt.bind(this)),this.storyBadges.on("mouseleave",this.hideBadgePrompt.bind(this)),this.el.is(".stories-new")){var t;this.urlField.on("input",function(){clearTimeout(t),t=setTimeout(this.checkForDuplicateURL.bind(this),500)}.bind(this)).on("keydown",function(){clearTimeout(t)}.bind(this))}},showBadgePrompt:function(t){var e=$(t.target),i=e.attr("data-title"),s=e.attr("data-link"),a=e.attr("data-comment");i&&i.length&&this.titleField.addClass("prompting").attr("placeholder",i),s&&s.length&&this.urlField.addClass("prompting").attr("placeholder",s),a&&a.length&&this.commentField.addClass("prompting").attr("placeholder",a)},hideBadgePrompt:function(){this.titleField.removeClass("prompting").attr("placeholder",this.titleField.attr("data-placeholder")),this.urlField.removeClass("prompting").attr("placeholder",this.urlField.attr("data-placeholder")),this.commentField.removeClass("prompting").attr("placeholder",this.commentField.attr("data-placeholder"))},checkContentInputs:function(t){$(t.target).is(this.urlField)?this.commentField.prop("disabled",this.urlField.val().length>0):$(t.target).is(this.commentField)&&this.urlField.prop("disabled",this.commentField.val().length>0)},checkForDuplicateURL:function(){var t=this.urlField.val();if(!t.length)return this.duplicateWarnContainer.hide();var e=$.post("/stories/dupe-check","url="+encodeURI(t));e.done(function(t){t.duplicate?(this.duplicateWarnContainer.show(),this.duplicateWarnContainer.find("#duplicate-time-frame-text").attr("href","/stories/"+t.story.id).text(t.story.date),this.duplicateWarnContainer.find("#duplicate-warning-force").val(1)):(this.duplicateWarnContainer.hide(),this.duplicateWarnContainer.find("#duplicate-warning-force").val(0))}.bind(this))},updateSponsoredDate:function(){this.sponsoredCheckbox.is(":checked")?this.sponsoredDate.removeClass("hidden"):this.sponsoredDate.val("").addClass("hidden")},submitStory:function(t){if(t.preventDefault(),!this.urlField.val().length&&!this.commentField.val().length){var e='<div class="modal-padding rte">';e+="<p>Sorry friend, you need to add a Link or a Comment to post a story.</p>",e+="</div>";var i=new Stage.modal({title:"Couldn't post story.",content:e});return i.render(),void 0}if(this.urlField.val().length&&0==/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(this.urlField.val())){var e='<div class="modal-padding rte">';e+="<p>The link you're using doesn't look like a proper URL. Are you missing a protocol (like <code>http://</code>)?</p>",e+="</div>";var i=new Stage.modal({title:"Couldn't post story.",content:e});return i.render(),void 0}this.submitButton.addClass("spinner-active");var s=$.post(this.storyForm.attr("action"),this.storyForm.serialize());s.done(function(t){window.location="/stories/"+t.id}),s.fail(function(t){if(this.submitButton.removeClass("spinner-active"),"redirect_url"===Object.keys(t.responseJSON.objects[0])[0]){var e='<div class="modal-padding rte">';e+="<p>In an effort to maintain high quality content on Designer News we've had to disallow posting stories with a URL that redirects. Please try posting the final address when loading the URL.</p>",e+="</div>";var i=new Stage.modal({title:"Couldn't post story.",content:e});return i.render()}if("banned_url"===Object.keys(t.responseJSON.objects[0])[0]){var e='<div class="modal-padding rte">';e+="<p>In an effort to maintain high quality content on Designer News we've had to disallow posting stories from the URL <b>"+t.responseJSON.objects[0].banned_url+"</b>.</p>",e+="</div>";var i=new Stage.modal({title:"Couldn't post story.",content:e});return i.render()}this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))}}),Stage.registerModule("stories",{initialize:function(){$(".story-star-button").on("click",this.triggerStar.bind(this)),$(".story-upvote-button").on("click",this.triggerUpvote.bind(this))},triggerStar:function(t){var e=$(t.target).is(".story-star-button")?$(t.target):$(t.target).closest(".story-star-button"),i=e.closest("[data-story-id]"),s=i.attr("data-story-id");t.preventDefault(),i.toggleClass("story-starred");var a=$.post("/stories/"+s+"/star");a.fail(function(t){i.toggleClass("story-starred"),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))},triggerUpvote:function(t){var e=$(t.target).is(".story-upvote-button")?$(t.target):$(t.target).closest(".story-upvote-button"),i=e.closest("[data-story-id]"),s=i.attr("data-story-id");if(!e.hasClass("disabled")){if(e.hasClass("toggle-login"))return this._.modules["header.account"].toggleLogin();e.toggleClass("upvoted");var a=$.post("/votes/upvote.json","story_id="+s);a.fail(function(t){e.toggleClass("upvoted"),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))}}}),Stage.registerModule("stories.show",{el:$(".stories-show"),initialize:function(){var t=function(){return("ontouchstart"in window||navigator.maxTouchPoints)===!0}();window.location.hash&&/comment-/.test(window.location.hash)&&this.highlightComment(window.location.hash),this.mainContainer=this.$("#story-main-container"),this.storyID=this.mainContainer.attr("data-story-id"),this.commentsList=this.$("#story-comments > #story-comments-list"),this.topLevelComments=this.commentsList.children(".story-comment"),this.commentSorters=this.$("#story-comments-sort-list li a"),this.commentSorting="rating asc",window.localStorage.getItem("comment-sorting")&&this.sortTopLevelComments(null,window.localStorage.getItem("comment-sorting")),this.el.on("click","#story-report",this.reportStory.bind(this)),this.el.on("click","#story-delete",this.deleteStory.bind(this)),this.el.on("click","#story-sink",this.sinkStory.bind(this)),this.el.on("click","#story-pin",this.pinStory.bind(this)),this.el.on("click","#story-downvote",this.downvoteStory.bind(this)),this.commentSorters.on("click",this.sortTopLevelComments.bind(this)),t?this.el.on("click","#story-header-more-container",this.showStoryNav.bind(this)):this.el.on("mouseenter","#story-header-more-container",this.showStoryNav.bind(this)),this.el.on("mouseleave","#story-header-more-container",this.closeDropNav.bind(this))},showStoryNav:function(t){var e=$(t.target);e.closest("#story-header-more-navigation").length||(e=e.is("#story-header-more-container")?e:e.closest("#story-header-more-container"),"click"===t.type?(t.preventDefault(),e.toggleClass("active")):e.addClass("active"))},closeDropNav:function(t){var e=$(t.target).is("#story-header-more-container")?$(t.target):$(t.target).closest("#story-header-more-container");e.removeClass("active")},reportStory:function(t){var e='<div class="modal-padding rte" id="report-content-model">';e+="<p>Are you sure you want to report this story to moderators?</p>",e+='<div class="select-wrapper"><select><option selected>This looks like spam</option><option>This looks like a voting ring</option><option>This is offensive</option><option>I don\'t think this should be on DN</option></select><span class="select-label">This looks like spam</span></div>',e+='<button id="confirm-comment-report" class="standard-button outline">Yes, report this story.</button>',e+="</div>";var i=new Stage.modal({title:"Report this story.",content:e}),s=function(){var t=$.post("/stories/"+this.storyID+"/report"+"?message="+i.$("select").find(":selected").text());t.done(function(){i.$("#report-content-model").html("<p>Thank you! Someone will take a look at this and take the appropriate action.</p>")}),t.fail(function(t){i.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))};t.preventDefault(),i.render(),i.content.on("click","#confirm-comment-report",s.bind(this))},deleteStory:function(t){t.preventDefault();var e='<div class="modal-padding rte" id="delete-content-model">';e+="<p>Are you sure you want to delete this post? It cannot be undone.</p>",e+='<button id="confirm-delete-story" class="standard-button outline">Yes, delete this story.</button>',e+="</div>";var i=new Stage.modal({title:"Delete this story.",content:e}),s=function(){var t=$.ajax({url:"/stories/"+this.storyID,type:"DELETE"});t.done(function(){return window.location="/"}),t.fail(function(t){i.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))};t.preventDefault(),i.render(),i.content.on("click","#confirm-delete-story",s.bind(this))},sinkStory:function(t){t.preventDefault();var e=$(t.target),i=$.post("/stories/"+this.storyID+"/sink");i.done(function(t){e.text(t.sunk?"Unsink":"Sink")}),i.fail(function(t){this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))},pinStory:function(t){t.preventDefault();var e=$(t.target),i=$.post("/stories/"+this.storyID+"/pin");i.done(function(t){e.text(t.pinned?"Unpin":"Pin")}),i.fail(function(t){this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))},downvoteStory:function(t){t.preventDefault();var e=this.mainContainer.find(".story-upvote-button-number"),i=$.post("/votes/downvote.json","story_id="+this.storyID);i.done(function(){$(t.target).remove(),e.each(function(t,e){e=$(e),e.text(Number(e.text())-1)})}),i.fail(function(t){this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))},highlightComment:function(t){var e=this.$(t);if(e.length){var i=e.children(".story-comment-inner");i.addClass("highlight").one("animationend webkitAnimationEnd",function(){i.off("animationend webkitAnimationEnd"),i.removeClass("highlight")})}},sortTopLevelComments:function(t,e){var i,s,a;if(t){t.preventDefault();var o=$(t.target);i=o.data("sort-by"),s=o.data("sort-order"),a=i+" "+s,window.localStorage.setItem("comment-sorting",a)}else a=e,i=a.split(" ")[0],s=a.split(" ")[1];a!==this.commentSorting&&(this.commentSorting=a,this.commentSorters.removeClass("active"),t?o.addClass("active"):this.commentSorters.filter(function(t,e){return $(e).attr("data-sort-by")===i&&$(e).attr("data-sort-order")===s}).addClass("active"),this.topLevelComments=this.topLevelComments.sort(function(t,e){var a=t.getAttribute("data-"+i),o=e.getAttribute("data-"+i);return a>o?"desc"===s?1:-1:o>a?"desc"===s?-1:1:0}),this.commentsList.html(this.topLevelComments),this._.modules.comments.initialize())}}),Stage.registerModule("users.edit",{el:$(".users-edit"),initialize:function(){this.saveButtons=this.$(".save-account-settings"),this.setupPixelPickers(),this.saveButtons.on("click",this.saveAccountSettings.bind(this)),this.el.on("click","#delete-account-button",this.deleteAccount.bind(this))},saveAccountSettings:function(){this.saveButtons.addClass("spinner-active")},setupPixelPickers:function(){var t=this.$(".pixel-picker"),e=this.$(".pixel-input");t.each(function(t,i){i=$(i),i.pixelPicker({rowSelector:".cell-row",cellSelector:".cell",eraserColor:[255,255,255],palette:i.data("acceptable-colors").reverse(),update:e.filter("[data-pixel="+i.data("picker")+"]")})})},deleteAccount:function(){var t=$(event.target).attr("data-id"),e='<div class="modal-padding rte" id="delete-content-model">';e+="<p>Are you <b>absolutely</b> sure you want to delete your account? It is <i>actually</i> deleted, permanently, forever. No take backs. Seriously.</p>",e+='<button id="confirm-delete-account" class="standard-button red">Yes, delete my account forever.</button>',e+="</div>";var i=new Stage.modal({title:"Delete account.",content:e}),s=function(){var e=$.ajax({url:"/users/"+t,type:"DELETE"});e.done(function(){return window.location.href="/"}),e.fail(function(t){i.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))};event.preventDefault(),i.render(),i.content.on("click","#confirm-delete-account",s.bind(this))}}),Stage.registerModule("users",{}),Stage.registerModule("users.show",{el:$(".users-show"),initialize:function(){this.userID=this.$("#profile-basic-info").attr("data-id"),this.loadingProfileContent=!1,this.el.on("click","#profile-additional-invites-toggle",this.showAdditionalInvites.bind(this)),this.el.on("click","#report-user-button",this.reportUser.bind(this)),this.el.on("click","#ban-user-button",this.banUser.bind(this)),this.el.on("click","#unban-user-button",this.unbanUser.bind(this)),this.el.on("click",".profile-load-more",this.loadMoreContent.bind(this))
},reportUser:function(t){var e='<div class="modal-padding rte" id="report-content-model">';e+="<p>Are you sure you want to report this user to moderators?</p>",e+='<div class="select-wrapper"><select><option selected>Account looks like spam</option><option>Account impersonates someone or is anonymous</option><option>Account is offensive</option><option>I don\'t think this should be on DN</option></select><span class="select-label">Account looks like spam</span></div>',e+='<button id="confirm-user-report" class="standard-button outline">Yes, report this story.</button>',e+="</div>";var i=new Stage.modal({title:"Report this user.",content:e}),s=function(){var t=$.post("/users/"+this.userID+"/report"+"?message="+i.$("select").find(":selected").text());t.done(function(){i.$("#report-content-model").html("<p>Thank you! Someone will take a look at this and take the appropriate action.</p>")}),t.fail(function(t){i.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))};t.preventDefault(),i.render(),i.content.on("click","#confirm-user-report",s.bind(this))},banUser:function(t){var e='<div class="modal-padding rte">';e+="<p>When a user is banned they cannot post content to the community. They will see a notice that their account has been suspended.</p>",e+="<p>Reason for banning this user:</p>",e+='<textarea class="standard-text-area" id="ban-user-reason-text" placeholder="Please state why you are banning this user..."></textarea>',e+='<button id="submit-user-ban" class="standard-button outline">Ban this user.</button>',e+="</div>";var i=new Stage.modal({title:"Ban user.",content:e,onRender:function(){setTimeout(function(){i.$("#ban-user-reason-text").focus()},100)}}),s=function(){var t=i.$("#ban-user-reason-text");if(!t.val().length)return t.addClass("error").focus();var e=$.post("/users/hellban.json","user_id="+this.userID+"&reason="+encodeURI(t.val()));e.done(function(){return window.location.reload()}),e.fail(function(t){i.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))};t.preventDefault(),i.render(),i.content.on("click","#submit-user-ban",s.bind(this))},unbanUser:function(){var t=$.post("/users/hellban.json","user_id="+this.userID);t.done(function(){return window.location.reload()}),t.fail(function(t){modal.exit(),this._.modules.site.errorModal(t.status,t.statusText)}.bind(this))},showAdditionalInvites:function(t){t.preventDefault(),this.$("#profile-additional-invites-toggle").remove(),this.$("#profile-additional-invites-container").removeClass("hidden").addClass("visible")},loadMoreContent:function(t){if(t.preventDefault(),!this.loadingProfileContent){var e={stories:function(t){var e;return e='<li class="montana-list-item">',e+='<a href="'+t.url+'" class="montana-item-title" rel="nofollow" target="_blank">',e+=this._.helpers.escapeHTML(t.title),t.url_domain&&(e+='<span class="list-story-domain"> ('+t.url_domain+")</span>"),e+="</a>",e+='<div class="montana-item-meta">',e+='<span class="story-points">'+t.vote_count+(1==t.vote_count?" point":" points")+"</span>",e+='<span class="montana-item-meta-bullet">•</span>',e+='<a href="/stories/'+t.id+'" class="list-story-comment-count">'+t.num_comments+(1==t.num_comments?" comment":" comments")+"</a>",e+='<span class="montana-item-meta-bullet">•</span>',e+='<a href="/stories/'+t.id+'" class="list-story-time-ago time-ago" title="'+t.created_at+'">'+t.time_ago+" ago</a>",e+="</div>",e+="</li>"}.bind(this),comments:function(t){var e;return e='<li class="nevada-list-item standard-padding">',e+='<header class="nevada-item-header">',e+='<span class="nevada-item-header-main">',e+='Posted to <a href="/stories/'+t.story.id+'">'+this._.helpers.escapeHTML(t.story.title)+"</a>,",null!=t.parent_author&&(e+=' in reply to <a href="/users/'+t.parent_author.id+'" rel="friend">'+t.parent_author.display_name+"</a>,"),e+="</span>",e+='<span class="nevada-item-header-sub">'+t.formatted_date+"</span>",e+="</header>",e+='<div class="story-comment-body nevada-item-body rte">'+markdown.toHTML(t.body)+"</div>",e+='<footer class="story-comment-footer nevada-item-meta">',e+='<span class="story-comment-points">'+t.rating+(1==t.rating?" point":" points")+"</span>",e+="</footer>",e+="</li>"}.bind(this),upvotes:function(t){return e.stories(t)}.bind(this),products:function(t){var e;return e='<div class="product-listing-item">',e+='<div class="product-listing-item-image">',e+='<img src="'+this._.modules.imgix.generate(t.media[0].url,{h:280,w:470,fit:"crop"})+'" srcset="'+this._.modules.imgix.generate(t.media[0].url,{h:280,w:470,fit:"crop"})+" 1x, "+this._.modules.imgix.generate(t.media[0].url,{h:280,w:470,dpr:2})+' 2x">',e+='<span class="product-listing-item-price">'+this._.modules.helpers.centsToMoney(t.base_price,!0)+"</span>",e+='<a href="/market/'+t.id+'" class="product-listing-item-overlay">',e+='<button type="button" class="standard-button outline">Quick View</button>',e+="</a>",e+="</div>",e+='<div class="product-item-titles">',e+='<h4 class="product-item-title"><a href="/market/'+t.id+'">'+t.title+"</a></h4>",e+='<p class="product-item-author">',e+='<img alt="'+t.author.display_name+'" class="user-portrait" src="/users/'+t.author.id+'/portrait" height="20" width="20">',e+='<span>By <a href="/market/shop/'+t.author.id+'">'+t.author_market_name+"</a></span>",e+="</p>",e+="</div>",e+="</div>"}.bind(this)},i=$(t.target),s=i.text(),a=i.attr("href"),o=i.attr("data-type"),n=Number(i.attr("data-offset")),r=i.closest(".tabbed-content-panel").find(".loadable-items-list");i.html('<span class="profile-content-loading-spinner"></span>'),this.loadingProfileContent=!0;var d=$.get(a+".json",{offset:n});d.done(function(t){return t[o].length?(t[o].forEach(function(t){r.append(e[o](t))}.bind(this)),i.attr("data-offset",n+10),void 0):i.remove()}.bind(this)),d.fail(function(t){this._.modules.site.errorModal(t.status,t.statusText)}.bind(this)),d.always(function(){i.html(s),this.loadingProfileContent=!1}.bind(this))}}}),Stage.start({log:"warn"});